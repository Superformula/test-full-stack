# Superformula Full Stack Developer Test

This is the guide to run and understand everything on the stack

## Backend

The Backend was built with AppSync + Terraform Scripts. 

Mapping files are on `terraform/appsync`

Resolvers are configured on `terraform/appsync.tf`

### User Model

| Variable    | Type                        | Description             |
| ----------- | --------------------------- | ----------------------- |
| id          | ID (String UUID)            | User ID                 |
| name        | String                      | User Name               |
| dob         | String (YYYY-MM-DD format)  | User Date of Birth      |
| address     | String                      | User Address            |
| latitude    | Float                       | User Location Latitude  |
| longitude   | Float                       | User Location Longitude |
| avatar      | String                      | User Avatar             |
| description | String                      | User Description        |
| createdAt   | String (Date ISO timestamp) | User Created Date       |
| updatedAt   | String (Date ISO timestamp) | User Updated Date       |

### Pushing the code

First configure the terraform variables

| Variable Name         | Description                                                  |
| --------------------- | ------------------------------------------------------------ |
| appname               | All resources created will have this variable as a prefix    |
| stage                 | All resources created will have this variable as a suffix    |
| google_maps_token     | You need to issue a Google Maps token in order to make some queries work (https://developers.google.com/maps/documentation/javascript/get-api-key) |
| aws_access_key_id     | The AWS IAM Access Key ID to run the terraform               |
| aws_secret_access_key | The AWS IAM Secret Access Key to run the terraform           |
| profile               | In case you have multi profiles on your aws-cli              |

### Before you push the code

Before applying the terraform script, you will need to build the lambda functions. It was built using serverless, but only for packaging, since it has some pretty cool features to manage dependencies and remove dev dependencies. I decided to centralize everything on Terraform to be easier to maintain.

Make sure you have serverless module installed globally

```
$ cd api
$ yarn
$ serverless package
```

### Applying Terraform

Once you have built the API and configured Terraform variables you can just run the basic command line

```
$ terraform apply
```



## Frontend

The frontend was built with React + Apollo Client.

### Environment Variables

There are some environment variables needed to configure in order to run the application

| Variable                   | Description                                                  |
| -------------------------- | ------------------------------------------------------------ |
| `REACT_APP_MAP_TOKEN`      | You will need to have a MapBox access token from the Mapbox page (https://docs.mapbox.com/help/how-mapbox-works/access-tokens/) |
| `REACT_APP_MAP_STYLE`      | Provide a map style URI from MapBox to have a different look and feel on the application (https://docs.mapbox.com/studio-manual/overview/map-styling/) |
| `REACT_APP_GRAPHQL_REGION` | AWS Region where AppSync is located                          |
| `REACT_APP_GRAPHQL_URI`    | AppSync endpoint. No need to configure the Realtime endpoint, it is resolved automatically |
| `REACT_APP_GRAPHQL_TOKEN`  | AppSync API Key                                              |

### GraphQL

The GraphQL is managed by GraphQL Code Generator (https://graphql-code-generator.com/). Some hooks are generated by it. For more information please refer to the doc.

### Before starting

Once you have created the backend, and have the AppSync Address and the API Key in hand. You will need to configure some files inside web folder to make sure the code generation will work.

The following files will need replace some values:

* `src/queries/.graphqlconfig`: This file is used by code editors like VSCode, WebStorm, etc.
* `web/codegen.yml`: This is used by GraphQL Code Generator
* `.env.local`: You will need to create this file based on `.env.example` in order to run the React Application

### Creating a new GraphQL query

In order to create a new query, you just need to create a new file or a new graphql query on any existing file inside `web/src/queries`, then, once created, you will need to go to the command line and execute the following line

```
$ yarn codegen
```