<div class="grid">
  <div class="col-desk-8">
    <h1 class="mb-19">User list</h1>
  </div>

  <div class="col-desk-4">
    <input type="text" placeholder="Search..." [formControl]="nameSearchControl">
  </div>
</div>

<div *ngIf="!isLoadingData; else loadingActive">
  <div class="grid">
    <div class="col-desk-4 col-tab-6 col-mob-12 pb-16" *ngFor="let user of users">
      <div class="card p-10" (click)="openEditModal(user)" id="card">
        <div class="edit-information mr-4 edit-icon">
          <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd"
              d="M4.59456 12.7577C4.42905 12.8604 4.29054 13.0137 4.20527 13.2127L2.08395 18.1625C1.72835 18.9922 2.56729 19.8311 3.39701 19.4755L8.34676 17.3542C8.54573 17.2689 8.69909 17.1304 8.8018 16.9649C8.87632 16.9136 8.94724 16.8549 9.0135 16.7886L16.7917 9.01043L18.2059 7.59622L19.9737 5.82845C20.7547 5.0474 20.7547 3.78107 19.9737 3.00002L18.5594 1.58581C17.7784 0.804761 16.5121 0.804761 15.731 1.58581L4.77086 12.546C4.7046 12.6122 4.64583 12.6831 4.59456 12.7577ZM6.53863 13.6066L7.95284 15.0208L15.3775 7.59622L13.9632 6.182L6.53863 13.6066ZM18.5594 4.41424L16.7917 6.182L15.3775 4.76779L17.1452 3.00002L18.5594 4.41424ZM5.46173 15.3582L4.90704 16.6524L6.20131 16.0977L5.46173 15.3582Z"
              fill="black" fill-opacity="0.4" />
          </svg>
        </div>

        <div class="center mb-7">
          <img class="avatar" src="https://source.unsplash.com/random/168x168">
        </div>

        <div class="grid mb-2">
          <div class=" col-desk-6 pb-0">
            <h2 class="ellipsis">{{user.name}}</h2>
          </div>

          <div class="col-desk-6 pb-0 align-self-center edit-information">
            <p class="right">
              created <span class="date-label">{{ user.createdAt | date: 'dd MMM yyyy' }}</span>
            </p>
          </div>
        </div>

        <p class="ellipsis">{{ user.description}}</p>
      </div>
    </div>
  </div>
</div>

<div class="center" *ngIf="users?.length > 0">
  <ng-template [ngIf]="!isLoadingButton" [ngIfElse]="loadingMoreData">
    <button class="btn uppercase" (click)="loadMore()" [class.disabled]="loadMoreDisabled" [disabled]="loadMoreDisabled"
      *ngIf="hideLoadingMoreButton">Load more</button>
  </ng-template>

  <ng-template #loadingMoreData>
    <img src="../../../../assets/utils/loader.svg" alt="Loader">
  </ng-template>
</div>

<app-dialog [(visible)]="showDialog">
  <div class="p-16">
    <h1 class="mb-16">Edit user</h1>

    <form class="grid" [formGroup]="userForm">
      <div class="col-desk-6">
        <ng-template [ngIf]="geoLocation" [ngIfElse]="loadingMap">
          <agm-map [latitude]="geoLocation.lat" [zoom]="15" [longitude]="geoLocation.long">
            <agm-marker [latitude]="geoLocation.lat" [longitude]="geoLocation.long"></agm-marker>
          </agm-map>
        </ng-template>

        <ng-template #loadingMap>
          <div class="center">
            <img src="../../../../assets/utils/loader.svg" alt="Loader">
          </div>
        </ng-template>
      </div>

      <div class="col-desk-6">
        <div class="mb-9">
          <span class="input-label mb-2">Name</span>
          <input class="w-12" type="text" placeholder="Name..." formControlName="name">
        </div>

        <div class="mb-9">
          <span class="input-label mb-2">Address</span>
          <input class="w-12" type="text" placeholder="Address..." formControlName="address">
        </div>

        <div class="mb-9">
          <span class="input-label mb-2">Description</span>
          <input class="w-12" type="text" placeholder="Description..." formControlName="description">
        </div>
      </div>
    </form>

    <div class="right">
      <button type="submit" (click)="showDialog = !showDialog" class="btn mr-12 uppercase"
        [class.disabled]="userForm.invalid" [disabled]="userForm.invalid" (click)="updateUser()">Save</button>
      <button type="button" (click)="showDialog = !showDialog" class="btn btn-secondary uppercase">Close</button>
    </div>
  </div>
</app-dialog>

<ng-template #loadingActive>
  <div class="center">
    <img src="../../../../assets/utils/loader.svg" alt="Loader">
  </div>
</ng-template>
